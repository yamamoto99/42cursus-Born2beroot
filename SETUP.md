# VirtualBox セットアップ方法

## 仮想マシンの作成

### ISO イメージの取得

このリポジトリでは `Debian` を利用して環境構築を行います。  
自身のマシンに合致する最新の`ISOイメージ`を [公式サイト](https://www.debian.org/distrib/netinst) からダウンロードしてください。  
プロセッサの確認は、ターミナルで右記のコマンドを実行して行います: `uname -m`

※ `x86_64` は `amd64` と同等です。

- `x86_64`: x86 アーキテクチャを 64bit に拡張したもの
- `amd64`: AMD 社が発表した、x86 アーキテクチャを 64bit に拡張したもの

### 仮想マシンの作成

1. まず VirtualBox を開き、`新規`をクリックします。  
   仮想マシンに適当な名前を付け、ダウンロードした`ISOイメージ`を選択します。  
   データの保存に関してはホームディレクトリが制限されているため、`sgoinfre`もしくは外付けディスクの利用を検討してください。  
   `自動インストールをスキップ`を選択し、次へ進みます。
2. 次に仮想マシンのハードウェアメモリ量と仮想 CPU 数を設定します。  
   `4096MB`と`4vCPU`を選択し、次へ進みます。  
   スペックに余裕がある場合は、もちろん性能を上げることが可能です。
3. 次に仮想 HDD のサイズを設定します。10GB でも十分ですが、デフォルトが 20GB なので 20GB 確保しておきます。  
   `仮想ハードディスクを作成する`を選択し、20GB 確保します。  
   `全サイズの事前割り当て`を選択し、次へ進みます。
4. 最終確認です。下記表の通りに設定が完了していたら完了をクリックして仮想マシンの作成を完了します。  
   指定したディレクトリにマシン名がついたディレクトリが作成されていることを確認してください。

#### 仮想マシン設定項目

| 分類                 | 設定項目                   | 値                               |
| -------------------- | -------------------------- | -------------------------------- |
| マシン名と OS タイプ | マシン名                   | 任意の名前                       |
|                      | マシンフォルダー           | 任意のフォルダ (例: sgoinfre 等) |
|                      | ISO イメージ               | ダウンロードした ISO イメージ    |
|                      | ゲスト OS のタイプ         | Debian (64-bit)                  |
|                      | 自動インストールのスキップ | true                             |
| ハードウェア         | メインメモリー             | 4096                             |
|                      | プロセッサー数             | 4                                |
|                      | EFI 有効                   | false                            |
| ディスク             | ディスクサイズ             | 20.00 GB                         |
|                      | 全サイズの自動割り当て     | true                             |

## オペレーティングシステムのインストール

続いて、オペレーティングシステムのインストールを行います。以下の手順に沿って進めてください。

### 言語設定とユーザー作成

1. VirtualBox の GUI から `起動` を選択します。  
   （今回は GUI は使用せず、通常の `Install` を選択します。）
2. 言語設定で`日本語`を選択し、場所は`日本`、キーボード設定は`米国`にして次へ進みます。
3. システムのホスト名を入力します。課題要件に従い、`intraログイン名+42` を入力してください。
4. ドメイン名の設定項目は今回は設定せず、空欄のまま次へ進みます。
5. `rootユーザー` のパスワードを設定します。（後で変更しますが、課題要件のパスワードポリシーに従って作成してください。）
6. 新規ユーザーの作成に進みます。
   - 「新しいユーザーの本名（フルネーム）」
   - 「あなたのアカウントのユーザー名」  
     いずれも、課題要件に従い `intraログイン名` を入力して次へ進みます。
7. 最後にパスワードを設定し（後で変更しますが、課題要件のパスワードポリシーに従って作成してください。）、ユーザー設定を完了させます。

### ディスクのパーティショニング

1. パーティショニングの方法から`ガイド - ディスク全体を使い、暗号化LVMをセットアップする`を選択します。
2. パーティショニング機構から`/home, /var, /tmp パーティションを分割`を選択します。
3. 確認メッセージが出るので`はい`を選択します。
4. 暗号化用のパスワードが要求されるので、設定します。課題のパスワード要件はここには適用されません。  
   ※このパスワードは VM 起動時に求められるので、記憶する必要があります。
5. ガイドによるパーティショニングを利用するボリュームのサイズを選択します。ここでは`15GB`を入力します。
6. `論理ボリュームマネージャーの設定`を選択します。パーティション初期化の警告が出るので、`はい`を選択します。
7. LVM 設定画面に到達したら、まずは`srv`を作成します。
   - 「論理ボリュームの作成」を選択します。
   - ボリュームグループを選択（選択肢が 1 つの場合はそのままで OK）
   - 論理ボリュームの名前を `srv` に設定
   - ボリュームサイズを `4000MB` に設定
8. 次に`var-log`を作成します。
   - 「論理ボリュームの作成」を選択します。
   - ボリュームグループを選択（選択肢が 1 つの場合はそのままで OK）
   - 論理ボリュームの名前を `var-log` に設定
   - ボリュームサイズを `1950MB` に設定
9. 完了を選択してパーティションの設定画面へ戻ります。
10. 続いてパーティション設定画面から LVM 内の`/srv用の論理ボリューム（4.0GB）`を選択し、設定を行います。
    - パーティション設定の`利用方法：利用しない`を選択します。
    - パーティションの利用方法から`ext4 ジャーナリングファイルシステム`を選択します。
    - パーティションの利用方法が`利用方法：ext4 ジャーナリングファイルシステム`に変更されていることを確認します。
    - マウントポイントの編集を行います。
    - マウントポイントを選択
    - `/srv`に設定
    - マウントポイントが`/srv`に変更されていることを確認します。
      以上で`srv`の設定は終了です。パーティションのセットアップを終了を選択します。
11. 次にパーティション設定画面から LVM 内の`/var/log用の論理ボリューム（2.0GB）`を選択し、設定を行います。
    - 先ほどと同じようにジャーナリングファイルシステムを選択します。
    - マウントポイントを選択する際、デフォルトで`/var/log`が存在しないので、手動で追加してください。
    - ジャーナリングファイルシステムが`ext4`、マウントポイントが`/var/log`になっていることを確認します。
    - 設定を終了します。
12. パーティションのセットアップを終了を選択します。
13. `パーティショニングの終了とディスクへの変更の書き込み`を選択し、パーティショニングを終了します。
14. パーティション設定の変更内容をディスクに書き込む確認が出るので、`はい`を選択します。

### その他の設定

1. 追加のメディアをスキャンするか確認が出ますが、`いいえ`を選択します。
2. Debian アーカイブミラーの国から`日本`を選択します。
3. Debian アーカイブミラーから`deb.debian.org`を選択します。
4. HTTP プロキシの情報は無いので空のまま続行します。
5. ソフトウェアの選択では`SSHサーバー`、`標準システムユーティリティ`の 2 つを選択し、続行します。  
   ※スペースを利用して選択、解除ができます。
6. GRUB ブートローダーをインストールするか質問された場合、`はい`を選択し、`/dev/sda`を選択します。
7. インストールが完了したら再起動してください。

以上でオペレーティングシステムのインストールは完了です。
